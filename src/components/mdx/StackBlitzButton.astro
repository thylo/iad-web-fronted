---
/**
 * Composant StackBlitzButton
 * Crée un bouton qui ouvre un projet Svelte dans StackBlitz
 * Le code est passé via slot pour rester éditable dans le MDX
 */

interface Props {
  title?: string;
  label?: string;
}

const { 
  title = 'Svelte Example', 
  label = 'Ouvrir dans StackBlitz' 
} = Astro.props;

// Récupérer le code Svelte depuis le slot
const svelteCode = await Astro.slots.render('default');

// Configuration du projet StackBlitz
const project = {
  title,
  description: 'Exemple du cours RTMF1M - Sites Web Dynamiques 2',
  template: 'node',
  dependencies: {
    'svelte': '^5.0.0',
    'vite': '^5.0.0',
    '@sveltejs/vite-plugin-svelte': '^4.0.0'
  },
  files: {
    'package.json': {
      content: JSON.stringify({
        name: 'svelte-example',
        private: true,
        version: '0.0.0',
        type: 'module',
        scripts: {
          dev: 'vite',
          build: 'vite build',
          preview: 'vite preview'
        },
        dependencies: {
          'svelte': '^5.0.0'
        },
        devDependencies: {
          '@sveltejs/vite-plugin-svelte': '^4.0.0',
          'vite': '^5.0.0'
        }
      }, null, 2)
    },
    'vite.config.js': {
      content: `import { defineConfig } from 'vite'
import { svelte } from '@sveltejs/vite-plugin-svelte'

export default defineConfig({
  plugins: [svelte()]
})`
    },
    'index.html': {
      content: `<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>${title}</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>`
    },
    'src/App.svelte': {
      content: svelteCode
    },
    'src/main.js': {
      content: `import './app.css'
import App from './App.svelte'

const app = new App({
  target: document.getElementById('app')
})

export default app`
    },
    'src/app.css': {
      content: `* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}`
    }
  }
};

// Encoder le projet pour StackBlitz
const projectJson = JSON.stringify(project);
---

<form 
  action="https://stackblitz.com/run" 
  method="POST" 
  target="_blank" 
  class="stackblitz-form"
>
  <input type="hidden" name="project[files]" value={projectJson} />
  <button type="submit" class="stackblitz-btn">
    <span class="icon">⚡</span>
    <span class="label">{label}</span>
  </button>
</form>

<style>
  .stackblitz-form {
    margin: 1rem 0;
    display: inline-block;
  }
  
  .stackblitz-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.125rem;
    background: linear-gradient(135deg, #1389fd 0%, #0d6efd 100%);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.9375rem;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
  }
  
  .stackblitz-btn:hover {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
    transform: translateY(-1px);
  }
  
  .stackblitz-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
  }
  
  .icon {
    font-size: 1.125rem;
    line-height: 1;
  }
  
  .label {
    line-height: 1;
  }
</style>
