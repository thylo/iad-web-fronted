---
title: Interactions avanc√©es
description: Aller au-del√† du clic avec drag & drop, gestes et clavier
---

## Objectif

Ma√Ætriser les interactions au-del√† du simple clic. Le web permet des gestes riches : glisser-d√©poser, secouer, appuis longs, raccourcis clavier. Ces interactions cr√©ent des exp√©riences plus immersives et personnelles.

**Ce que vous allez apprendre :**
- Drag and drop
- D√©tection de gestes (shake, swipe, long-press)
- √âv√©nements clavier et combos
- Inputs utilisateur vari√©s

## 1. Drag and Drop

Glisser-d√©poser est essentiel pour manipuler des objets virtuels : trier des cartes, organiser un espace, dessiner un parcours.

### Exemple : Carte d√©pla√ßable

```svelte
<script>
  let position = { x: 100, y: 100 };
  let isDragging = false;
  let offset = { x: 0, y: 0 };
  
  function handleMouseDown(event) {
    isDragging = true;
    // Calculer l'offset entre la position de la souris et le coin de l'√©l√©ment
    offset = {
      x: event.clientX - position.x,
      y: event.clientY - position.y
    };
  }
  
  function handleMouseMove(event) {
    if (!isDragging) return;
    
    position = {
      x: event.clientX - offset.x,
      y: event.clientY - offset.y
    };
  }
  
  function handleMouseUp() {
    isDragging = false;
  }
</script>

<svelte:window 
  on:mousemove={handleMouseMove}
  on:mouseup={handleMouseUp}
/>

<div 
  class="card" 
  class:dragging={isDragging}
  style="left: {position.x}px; top: {position.y}px;"
  on:mousedown={handleMouseDown}
  role="button"
  tabindex="0"
>
  Glissez-moi
</div>

<style>
  .card {
    position: absolute;
    padding: 2rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: grab;
    user-select: none;
  }
  
  .card.dragging {
    cursor: grabbing;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    z-index: 100;
  }
</style>
```

**Points cl√©s :**
- `<svelte:window>` : √©coute les √©v√©nements sur toute la page
- Calculer l'offset pour que l'√©l√©ment ne "saute" pas
- `user-select: none` : emp√™che la s√©lection de texte pendant le drag
- Curseur `grab` / `grabbing` pour feedback visuel

### Support tactile

```svelte
<script>
  function handleTouchStart(event) {
    const touch = event.touches[0];
    isDragging = true;
    offset = {
      x: touch.clientX - position.x,
      y: touch.clientY - position.y
    };
  }
  
  function handleTouchMove(event) {
    if (!isDragging) return;
    event.preventDefault(); // Emp√™che le scroll
    
    const touch = event.touches[0];
    position = {
      x: touch.clientX - offset.x,
      y: touch.clientY - offset.y
    };
  }
  
  function handleTouchEnd() {
    isDragging = false;
  }
</script>

<div
  on:touchstart={handleTouchStart}
  on:touchmove={handleTouchMove}
  on:touchend={handleTouchEnd}
>
  <!-- ... -->
</div>
```

## 2. D√©tection de gestes

Les gestes ajoutent une couche d'interactivit√© physique. Secouer pour r√©initialiser, appui long pour r√©v√©ler, swipe pour naviguer.

### Shake (secouer)

```svelte
<script>
  import { onMount } from 'svelte';
  
  let shakeCount = 0;
  let lastX = 0, lastY = 0, lastZ = 0;
  const SHAKE_THRESHOLD = 15; // Sensibilit√©
  
  onMount(() => {
    if (!window.DeviceMotionEvent) {
      console.warn('Acc√©l√©rom√®tre non disponible');
      return;
    }
    
    function handleMotion(event) {
      const { x, y, z } = event.accelerationIncludingGravity;
      
      // Calculer le changement d'acc√©l√©ration
      const deltaX = Math.abs(x - lastX);
      const deltaY = Math.abs(y - lastY);
      const deltaZ = Math.abs(z - lastZ);
      
      if (deltaX + deltaY + deltaZ > SHAKE_THRESHOLD) {
        shakeCount++;
      }
      
      lastX = x;
      lastY = y;
      lastZ = z;
    }
    
    window.addEventListener('devicemotion', handleMotion);
    
    return () => {
      window.removeEventListener('devicemotion', handleMotion);
    };
  });
</script>

<p>Secousses d√©tect√©es : {shakeCount}</p>
```

**Usage narratif :** Secouer pour r√©v√©ler un secret, effacer un dessin, g√©n√©rer un √©v√©nement al√©atoire.

### Long press (appui long)

```svelte
<script>
  let pressTimer;
  let isLongPressed = false;
  const LONG_PRESS_DURATION = 800; // ms
  
  function handlePressStart() {
    pressTimer = setTimeout(() => {
      isLongPressed = true;
      // Action √† l'appui long
      console.log('Appui long d√©tect√©');
    }, LONG_PRESS_DURATION);
  }
  
  function handlePressEnd() {
    clearTimeout(pressTimer);
    if (!isLongPressed) {
      // C'√©tait un clic normal
      console.log('Clic court');
    }
    isLongPressed = false;
  }
</script>

<button
  on:mousedown={handlePressStart}
  on:mouseup={handlePressEnd}
  on:mouseleave={handlePressEnd}
  on:touchstart={handlePressStart}
  on:touchend={handlePressEnd}
  on:touchcancel={handlePressEnd}
>
  Maintenez appuy√©
</button>
```

**Usage narratif :** R√©v√©ler une information cach√©e, charger une action, √©couter un son.

### Swipe (glissement directionnel)

```svelte
<script>
  let touchStartX = 0;
  let touchStartY = 0;
  const SWIPE_THRESHOLD = 50; // Pixels minimum
  
  function handleTouchStart(event) {
    const touch = event.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
  }
  
  function handleTouchEnd(event) {
    const touch = event.changedTouches[0];
    const deltaX = touch.clientX - touchStartX;
    const deltaY = touch.clientY - touchStartY;
    
    // D√©tecter la direction dominante
    if (Math.abs(deltaX) > Math.abs(deltaY)) {
      // Swipe horizontal
      if (Math.abs(deltaX) > SWIPE_THRESHOLD) {
        if (deltaX > 0) {
          console.log('Swipe droite');
        } else {
          console.log('Swipe gauche');
        }
      }
    } else {
      // Swipe vertical
      if (Math.abs(deltaY) > SWIPE_THRESHOLD) {
        if (deltaY > 0) {
          console.log('Swipe bas');
        } else {
          console.log('Swipe haut');
        }
      }
    }
  }
</script>

<div
  on:touchstart={handleTouchStart}
  on:touchend={handleTouchEnd}
  class="swipe-area"
>
  Swipez dans n'importe quelle direction
</div>

<style>
  .swipe-area {
    width: 100%;
    height: 300px;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: pan-y; /* Autorise le scroll vertical */
  }
</style>
```

**Usage narratif :** Navigation entre sc√®nes, exploration spatiale, contr√¥le de timeline.

## 3. √âv√©nements clavier

Le clavier offre des interactions rapides et pr√©cises. Utile pour des jeux, des raccourcis, ou des exp√©riences po√©tiques bas√©es sur la frappe.

### √âcoute simple

```svelte
<script>
  import { onMount } from 'svelte';
  
  let lastKey = '';
  
  onMount(() => {
    function handleKeyPress(event) {
      lastKey = event.key;
    }
    
    window.addEventListener('keydown', handleKeyPress);
    
    return () => {
      window.removeEventListener('keydown', handleKeyPress);
    };
  });
</script>

<p>Derni√®re touche : {lastKey}</p>
```

### Combos et modificateurs

```svelte
<script>
  function handleKeyDown(event) {
    // D√©tection de combo : Ctrl + S
    if (event.ctrlKey && event.key === 's') {
      event.preventDefault(); // Emp√™che la sauvegarde du navigateur
      console.log('Sauvegarde personnalis√©e');
    }
    
    // D√©tection de fl√®ches
    if (event.key === 'ArrowUp') {
      console.log('Haut');
    }
    
    // Shift + clic pour une action alternative
    if (event.shiftKey) {
      console.log('Shift maintenu');
    }
  }
</script>

<svelte:window on:keydown={handleKeyDown} />
```

### S√©quence de touches (Konami code)

```svelte
<script>
  const KONAMI_CODE = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 
                       'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 
                       'b', 'a'];
  let sequence = [];
  
  function handleKeyDown(event) {
    sequence = [...sequence, event.key].slice(-KONAMI_CODE.length);
    
    if (JSON.stringify(sequence) === JSON.stringify(KONAMI_CODE)) {
      console.log('üéâ Code secret activ√© !');
      sequence = []; // Reset
    }
  }
</script>

<svelte:window on:keydown={handleKeyDown} />
```

**Usage narratif :** Easter eggs, codes secrets, contr√¥le de personnage, instrument musical.

## 4. Inputs utilisateur

Les formulaires ne sont pas que pour des sites corporate. Utilis√©s cr√©ativement, ils deviennent des outils de narration.

### Input texte r√©actif

```svelte
<script>
  let userInput = '';
  
  $: wordCount = userInput.trim().split(/\s+/).filter(Boolean).length;
  $: mood = userInput.includes('!') ? 'excit√©' : 
            userInput.includes('?') ? 'interrogatif' : 'neutre';
</script>

<textarea bind:value={userInput} placeholder="√âcrivez quelque chose..."></textarea>

<p>Mots : {wordCount}</p>
<p>Ton d√©tect√© : {mood}</p>
```

**Usage narratif :** Journal intime, texte dont l'apparence change selon ce que vous √©crivez.

### Slider comme contr√¥le narratif

```svelte
<script>
  let timeOfDay = 12; // 0-24
  
  $: skyColor = `hsl(${210 + timeOfDay * 3}, 70%, ${80 - timeOfDay * 2}%)`;
  $: period = timeOfDay < 6 ? 'nuit' :
              timeOfDay < 12 ? 'matin' :
              timeOfDay < 18 ? 'apr√®s-midi' :
              'soir√©e';
</script>

<div class="scene" style="background: {skyColor};">
  <p>Il est {timeOfDay}h, c'est le {period}.</p>
</div>

<input 
  type="range" 
  min="0" 
  max="24" 
  bind:value={timeOfDay}
  aria-label="Heure de la journ√©e"
/>

<style>
  .scene {
    width: 100%;
    height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
    color: white;
    font-size: 1.5rem;
  }
  
  input[type="range"] {
    width: 100%;
    margin-top: 1rem;
  }
</style>
```

**Usage narratif :** Contr√¥le du temps, de l'humeur d'un personnage, de l'intensit√© d'une sc√®ne.

### Choix multiples visuels

```svelte
<script>
  let selectedMood = null;
  
  const moods = [
    { id: 'happy', emoji: 'üòä', label: 'Joyeux' },
    { id: 'sad', emoji: 'üò¢', label: 'Triste' },
    { id: 'angry', emoji: 'üò†', label: 'En col√®re' },
    { id: 'neutral', emoji: 'üòê', label: 'Neutre' }
  ];
</script>

<p>Comment vous sentez-vous ?</p>

<div class="mood-selector">
  {#each moods as mood}
    <button
      class="mood-btn"
      class:selected={selectedMood === mood.id}
      on:click={() => selectedMood = mood.id}
    >
      <span class="emoji">{mood.emoji}</span>
      <span class="label">{mood.label}</span>
    </button>
  {/each}
</div>

{#if selectedMood}
  <p>Vous avez choisi : {moods.find(m => m.id === selectedMood)?.label}</p>
{/if}

<style>
  .mood-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
  }
  
  .mood-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: white;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .mood-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .mood-btn.selected {
    border-color: #4CAF50;
    background: #f0f8f0;
  }
  
  .emoji {
    font-size: 2rem;
  }
  
  .label {
    font-size: 0.9rem;
  }
</style>
```

## Exercice : Tableau de bord interactif

Cr√©ez une interface qui combine plusieurs types d'interactions :

**Contraintes :**
- Un √©l√©ment d√©pla√ßable en drag & drop
- Un slider qui influence l'apparence
- Un raccourci clavier cach√©
- Une zone swipe (mobile)
- Un input texte qui change la narration

**Exemple de concept :**
- Tableau de bord d'un vaisseau spatial
- Studio d'enregistrement virtuel
- Interface de cr√©ation de cr√©ature
- Console de contr√¥le temporel

## Ce que vous avez appris

- ‚úÖ Impl√©menter du drag & drop (souris + tactile)
- ‚úÖ D√©tecter des gestes (shake, swipe, long-press)
- ‚úÖ √âcouter le clavier (touches, combos, s√©quences)
- ‚úÖ Utiliser les inputs comme outils narratifs
- ‚úÖ Combiner plusieurs interactions dans une exp√©rience coh√©rente

## Ressources

- [Recette : Drag and drop](/rtmf1m/recettes/02-interactions/drag-and-drop)
- [Recette : D√©tection de gestes](/rtmf1m/recettes/02-interactions/detection-gestes)
- [Recette : Clavier et combos](/rtmf1m/recettes/02-interactions/clavier-combos)
- [Recette : Input utilisateur](/rtmf1m/recettes/02-interactions/input-utilisateur)
- [MDN : Touch events](https://developer.mozilla.org/en-US/docs/Web/API/Touch_events)
- [MDN : Keyboard events](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent)
